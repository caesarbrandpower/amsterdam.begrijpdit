<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BegrijpDit voor Gemeente Amsterdam</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #faf7f2;
      --surface: #ffffff;
      --ink: #2c2420;
      --mid: #7a6b63;
      --soft: #b0a49c;
      --border: rgba(44,36,32,0.1);
      --accent: #E61E14;
      --accent-dark: #C4180F;
      --accent-light: #fef0ef;
      --accent-mid: #ee5248;
      --action-bg: #fff5f5;
      --action-border: #f5b8b5;
      --warm-dark: #3d2e28;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      padding: 1.25rem 2.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: rgba(250,247,242,0.94);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .logo {
      font-family: 'Merriweather', serif;
      font-weight: 600;
      font-size: 1.35rem;
      letter-spacing: -0.02em;
      color: var(--ink);
    }

    .logo span { color: var(--accent); }

    .by-norobot {
      font-size: 0.72rem;
      color: var(--soft);
      font-style: italic;
      font-family: 'Merriweather', serif;
      font-weight: 300;
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      padding: 5rem 2.5rem 3rem;
      max-width: 660px;
      margin: 0 auto;
      width: 100%;
    }

    .h1-main {
      font-size: 1em;
    }

    .h1-sub {
      font-size: 0.72em;
      opacity: 0.85;
    }

    .hero h1 {
      font-family: 'Merriweather', serif;
      font-size: clamp(2.2rem, 5.5vw, 3.4rem);
      font-weight: 400;
      line-height: 1.15;
      letter-spacing: -0.02em;
      margin-bottom: 1.25rem;
      color: var(--warm-dark);
    }

    .hero h1 em {
      font-style: italic;
      color: var(--accent);
    }

    .hero p {
      font-size: 1rem;
      line-height: 1.8;
      color: var(--mid);
      font-weight: 300;
      max-width: 460px;
    }

    /* ‚îÄ‚îÄ TOOL ‚îÄ‚îÄ */
    .tool-wrapper {
      max-width: 660px;
      margin: 0 auto;
      width: 100%;
      padding: 0 2.5rem 6rem;
      flex: 1;
    }

    .privacy-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--mid);
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 0.4rem 0.9rem;
      border-radius: 100px;
      margin-bottom: 1.25rem;
    }

    /* Input */
    .input-card {
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 16px rgba(44,36,32,0.05);
      margin-bottom: 0.875rem;
      transition: border-color 0.25s, box-shadow 0.25s;
    }

    .input-card:focus-within {
      border-color: var(--accent-mid);
      box-shadow: 0 4px 24px rgba(196,98,45,0.1);
    }

    .input-top {
      padding: 0.9rem 1.25rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .input-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      color: var(--soft);
    }

    .char-count {
      font-size: 0.7rem;
      color: var(--soft);
    }

    textarea {
      width: 100%;
      min-height: 190px;
      padding: 1.25rem;
      border: none;
      outline: none;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.95rem;
      line-height: 1.8;
      color: var(--ink);
      background: transparent;
      resize: vertical;
      font-weight: 300;
    }

    textarea::placeholder {
      color: #ccc5bd;
    }

    /* Button */
    .submit-btn {
      width: 100%;
      padding: 1rem 1.5rem;
      background: var(--accent);
      color: white;
      border: none;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.92rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      box-shadow: 0 3px 14px rgba(196,98,45,0.3);
      letter-spacing: 0.01em;
    }

    .submit-btn:hover:not(:disabled) {
      background: var(--accent-dark);
      box-shadow: 0 5px 20px rgba(196,98,45,0.4);
      transform: translateY(-1px);
    }

    .submit-btn:active:not(:disabled) { transform: translateY(0); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none; }

    .btn-arrow { transition: transform 0.2s; }
    .submit-btn:hover:not(:disabled) .btn-arrow { transform: translateX(4px); }

    /* Tabs */
    .input-tabs {
      display: flex;
      margin-bottom: 0.875rem;
    }

    .tab-btn {
      flex: 1;
      padding: 0.7rem 0.5rem;
      background: var(--surface);
      border: 1.5px solid var(--border);
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--soft);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }

    .tab-btn:first-child { border-radius: 10px 0 0 10px; }
    .tab-btn:last-child { border-radius: 0 10px 10px 0; border-left: none; }
    .tab-btn:not(:first-child):not(:last-child) { border-left: none; }

    .tab-btn.active {
      background: var(--accent-light);
      border-color: var(--accent-mid);
      color: var(--accent-dark);
    }

    .tab-btn:hover:not(.active) { background: var(--bg); color: var(--mid); }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .upload-zone {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 160px;
      padding: 2rem;
      cursor: pointer;
      transition: background 0.2s;
      text-align: center;
      gap: 0.75rem;
    }

    .upload-zone:hover { background: var(--bg); }
    .upload-zone input[type="file"] { display: none; }

    .upload-icon { font-size: 2rem; line-height: 1; }

    .upload-text {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--ink);
    }

    .upload-sub { font-size: 0.75rem; color: var(--soft); }

    .upload-selected {
      display: none;
      align-items: center;
      gap: 0.6rem;
      padding: 0.7rem 1rem;
      background: var(--accent-light);
      border-top: 1px solid var(--action-border);
      font-size: 0.82rem;
      color: var(--accent-dark);
      font-weight: 500;
    }

    .upload-selected.visible { display: flex; }

    /* Loading */
    .loading {
      display: none;
      padding: 3rem 0;
      text-align: center;
    }
    .loading.visible { display: block; }

    .loading-ring {
      width: 32px;
      height: 32px;
      border: 2.5px solid var(--accent-light);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      font-size: 0.88rem;
      color: var(--mid);
      font-style: italic;
      font-family: 'Merriweather', serif;
      font-weight: 300;
    }

    /* Output */
    .output-card {
      display: none;
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 16px rgba(44,36,32,0.06);
      animation: fadeUp 0.45s cubic-bezier(0.16, 1, 0.3, 1);
      margin-top: 1.25rem;
    }
    .output-card.visible { display: block; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .output-header {
      padding: 1.1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .output-check {
      width: 22px;
      height: 22px;
      background: #e8f5e9;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: #2e7d32;
      flex-shrink: 0;
    }

    .output-header-text {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--ink);
    }

    .output-header-sub {
      font-size: 0.72rem;
      color: var(--soft);
      margin-left: auto;
      font-style: italic;
      font-family: 'Merriweather', serif;
      font-weight: 300;
    }

    .output-body {
      padding: 1.75rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* Regular blocks */
    .output-block {
      animation: fadeUp 0.35s ease both;
    }
    .output-block:nth-child(1) { animation-delay: 0.05s; }
    .output-block:nth-child(3) { animation-delay: 0.1s; }
    .output-block:nth-child(4) { animation-delay: 0.15s; }

    .block-label {
      font-size: 0.67rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--soft);
      margin-bottom: 0.5rem;
    }

    .block-text {
      font-size: 0.95rem;
      line-height: 1.85;
      color: #3d3028;
      font-weight: 300;
    }

    /* ACTION BLOCK ‚Äî prominent */
    .action-block {
      background: var(--action-bg);
      border: 1.5px solid var(--action-border);
      border-radius: 12px;
      padding: 1.25rem 1.25rem 1rem;
      animation: fadeUp 0.35s ease both;
      animation-delay: 0.08s;
    }

    .action-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.9rem;
    }

    .action-icon {
      width: 26px;
      height: 26px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: white;
      flex-shrink: 0;
    }

    .action-title {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--accent-dark);
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .action-list {
      list-style: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .action-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      font-size: 0.95rem;
      line-height: 1.65;
      color: var(--warm-dark);
      font-weight: 400;
    }

    .action-list li::before {
      content: '‚Üí';
      color: var(--accent);
      font-weight: 600;
      flex-shrink: 0;
      margin-top: 0.05rem;
    }

    /* Divider */
    .output-divider {
      height: 1px;
      background: var(--border);
    }

    /* Closing note */
    .closing-note {
      font-size: 0.82rem;
      color: var(--mid);
      font-style: italic;
      font-family: 'Merriweather', serif;
      font-weight: 300;
      line-height: 1.7;
      padding-top: 0.25rem;
    }

    /* Output footer */
    .output-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .disclaimer {
      font-size: 0.7rem;
      color: var(--soft);
      font-style: italic;
      line-height: 1.5;
      max-width: 360px;
    }

    .reset-btn {
      background: transparent;
      border: 1px solid var(--border);
      padding: 0.55rem 1.1rem;
      border-radius: 8px;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--mid);
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .reset-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* Error */
    .error-box {
      display: none;
      margin-top: 0.75rem;
      padding: 0.9rem 1.1rem;
      background: #fff5f5;
      border: 1px solid #fecaca;
      border-radius: 10px;
      font-size: 0.85rem;
      color: #b91c1c;
    }
    .error-box.visible { display: block; }

    /* Footer */
    footer {
      padding: 1.75rem 2.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .footer-logo {
      font-family: 'Merriweather', serif;
      font-size: 0.82rem;
      font-weight: 400;
      color: var(--soft);
    }

    .footer-logo span { color: var(--accent); font-weight: 600; }

    .footer-note {
      font-size: 0.7rem;
      color: var(--soft);
      font-style: italic;
    }

    @media (max-width: 560px) {
      header, footer { padding: 1.25rem; }
      .hero { padding: 3rem 1.25rem 2rem; }
      .tool-wrapper { padding: 0 1.25rem 4rem; }
      .output-footer { flex-direction: column; align-items: flex-start; }
    }


    /* Suggesties */
    .suggesties {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .suggestie-btn {
      background: var(--accent-light);
      border: 1.5px solid var(--action-border);
      color: var(--accent-dark);
      padding: 0.5rem 0.9rem;
      border-radius: 100px;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .suggestie-btn:hover, .suggestie-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    /* SchrijfDit trigger */
    .schrijfdit-trigger {
      margin-top: 1.5rem;
      background: var(--warm-dark);
      border-radius: 16px;
      padding: 1.75rem 1.75rem 1.5rem;
      animation: fadeUp 0.4s ease both;
    }

    .schrijfdit-brand {
      font-family: 'Merriweather', serif;
      font-size: 0.82rem;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: -0.01em;
      margin-bottom: 0.3rem;
    }

    .schrijfdit-brand-header {
      font-family: 'Merriweather', serif;
      font-weight: 700;
      color: var(--accent);
    }

    .schrijfdit-trigger-inner {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    .schrijfdit-icon { font-size: 2rem; flex-shrink: 0; line-height: 1; }

    .schrijfdit-trigger-text {}

    .schrijfdit-title {
      font-family: 'Merriweather', serif;
      font-size: 1.1rem;
      font-weight: 400;
      color: white;
      margin-bottom: 0.4rem;
      line-height: 1.4;
    }

    .schrijfdit-sub {
      font-size: 0.78rem;
      color: rgba(255,255,255,0.55);
      line-height: 1.6;
    }

    .schrijfdit-btn {
      width: 100%;
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.9rem 1.5rem;
      border-radius: 10px;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      text-align: center;
    }

    .schrijfdit-btn:hover { background: var(--accent-dark); }

    /* SchrijfDit card */
    .schrijfdit-card {
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 16px rgba(44,36,32,0.06);
      margin-top: 1rem;
      animation: fadeUp 0.4s ease both;
    }

    .schrijfdit-form {
      padding: 1.5rem;
    }

    .schrijfdit-question {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 0.75rem;
    }

    .schrijfdit-output {
      padding: 0 1.5rem 1.5rem;
    }

    .schrijfdit-result-label {
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--soft);
      margin-bottom: 0.75rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
    }

    .schrijfdit-result {
      font-size: 0.95rem;
      line-height: 1.85;
      color: var(--ink);
      font-weight: 300;
      white-space: pre-wrap;
      background: var(--bg);
      padding: 1.25rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-bottom: 1rem;
    }

    .schrijfdit-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .copy-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.55rem 1.1rem;
      border-radius: 8px;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.72rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .copy-btn:hover { background: var(--accent-dark); }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 976.83 340.19" style="height:44px;width:auto;display:block"><defs><style>.cls-1{fill:#ec0000;}</style></defs><g id="Woorddeel"><path class="cls-1" d="M139.78,72.98c0-31.91,22.36-54.43,53.95-54.43,16.04,0,29.48,5.18,39.04,15.55l-13.93,13.28c-5.99-6.64-14.58-10.53-24.79-10.53-19.12,0-32.4,14.9-32.4,36.13s12.96,36.77,31.59,36.77c17.01,0,28.84-9.72,28.84-23.81v-2.75h-25.43v-17.66h46.82v16.36c0,26.89-20.9,45.85-50.87,45.85s-52.81-22.68-52.81-54.76Z"/><path class="cls-1" d="M257.06,85.78c0-24.79,16.69-41.96,40.5-41.96s40.34,17.01,40.34,41.47c0,1.94-.32,5.02-.65,7.13h-59.94c1.46,10.85,10.69,18.14,22.52,18.14,8.75,0,16.36-3.24,21.38-9.07l12.15,11.83c-7.29,9.4-19.93,14.42-34.51,14.42-24.62,0-41.8-17.33-41.8-41.96Zm20.25-8.1h40.34c-1.3-10.53-9.4-17.66-20.25-17.66s-18.95,7.13-20.09,17.66Z"/><path class="cls-1" d="M354.59,45.77h18.79v10.85h.32c4.05-8.26,11.18-12.8,20.41-12.8,10.37,0,18.14,4.54,23,13.61,4.86-8.75,13.77-13.61,25.11-13.61,19.76,0,29.32,11.02,29.32,33.53v48.44h-20.09v-45.04c0-13.12-4.54-19.44-13.93-19.44s-14.42,6.97-14.42,20.09v44.39h-20.09v-45.04c0-13.28-4.37-19.44-13.93-19.44s-14.42,7.13-14.42,20.09v44.39h-20.09V45.77Z"/><path class="cls-1" d="M487.43,85.78c0-24.79,16.69-41.96,40.5-41.96s40.34,17.01,40.34,41.47c0,1.94-.32,5.02-.65,7.13h-59.94c1.46,10.85,10.69,18.14,22.52,18.14,8.75,0,16.36-3.24,21.38-9.07l12.15,11.83c-7.29,9.4-19.93,14.42-34.51,14.42-24.62,0-41.8-17.33-41.8-41.96Zm20.25-8.1h40.34c-1.3-10.53-9.4-17.66-20.25-17.66s-18.95,7.13-20.09,17.66Z"/><path class="cls-1" d="M579.93,85.78c0-24.79,16.69-41.96,40.5-41.96s40.34,17.01,40.34,41.47c0,1.94-.32,5.02-.65,7.13h-59.94c1.46,10.85,10.69,18.14,22.52,18.14,8.75,0,16.36-3.24,21.38-9.07l12.15,11.83c-7.29,9.4-19.93,14.42-34.51,14.42-24.62,0-41.8-17.33-41.8-41.96Zm20.25-8.1h40.34c-1.3-10.53-9.4-17.66-20.25-17.66s-18.95,7.13-20.09,17.66Z"/><path class="cls-1" d="M677.45,45.77h18.95v10.85h.32c3.73-7.94,11.83-12.8,21.22-12.8,20.09,0,30.46,11.5,30.46,33.53v48.44h-20.09v-44.55c0-13.61-4.86-19.93-15.07-19.93s-15.71,7.13-15.71,20.41v44.06h-20.09V45.77Z"/><path class="cls-1" d="M774.16,97.12V62.45h-13.77v-16.69h7.29c6.64,0,9.23-2.59,9.23-9.23v-12.47h17.17v21.71h19.44v16.69h-19.44v34.67c0,7.78,4.05,12.15,11.5,12.15,2.27,0,5.02-.32,6.64-.81v16.85c-2.43,.65-6.97,1.13-10.53,1.13-18.14,0-27.54-10.04-27.54-29.32Z"/><path class="cls-1" d="M823.41,85.78c0-24.79,16.69-41.96,40.5-41.96s40.34,17.01,40.34,41.47c0,1.94-.32,5.02-.65,7.13h-59.94c1.46,10.85,10.69,18.14,22.52,18.14,8.75,0,16.36-3.24,21.38-9.07l12.15,11.83c-7.29,9.4-19.93,14.42-34.51,14.42-24.62,0-41.8-17.33-41.8-41.96Zm20.25-8.1h40.34c-1.3-10.53-9.4-17.66-20.25-17.66s-18.95,7.13-20.09,17.66Z"/><path class="cls-1" d="M177.52,214.89h24.3l42.12,105.3h-22.52l-8.75-23.17h-46.82l-8.75,23.17h-21.71l42.12-105.3Zm-5.35,64.64h34.02l-16.85-44.39h-.32l-16.85,44.39Z"/><path class="cls-1" d="M257.23,240.17h18.79v10.85h.32c4.05-8.26,11.18-12.8,20.41-12.8,10.37,0,18.14,4.54,23,13.61,4.86-8.75,13.77-13.61,25.11-13.61,19.76,0,29.32,11.02,29.32,33.54v48.44h-20.09v-45.04c0-13.12-4.54-19.44-13.93-19.44s-14.42,6.97-14.42,20.09v44.39h-20.09v-45.04c0-13.28-4.37-19.44-13.93-19.44s-14.42,7.13-14.42,20.09v44.39h-20.09v-80.03Z"/><path class="cls-1" d="M411.13,286.66c-10.85-3.24-21.38-9.07-21.38-23.65s12.31-24.79,30.62-24.79c12.31,0,21.87,4.37,27.22,12.47l-11.5,11.5c-4.05-5.02-9.56-7.78-15.55-7.78-6.8,0-11.02,3.08-11.02,7.94,0,6.48,6.8,7.61,16.69,10.69,10.85,3.24,21.38,9.07,21.38,23.65s-12.96,25.43-32.08,25.43c-12.47,0-22.52-4.37-28.35-12.64l11.5-11.5c4.37,5.18,10.21,7.94,16.69,7.94,7.78,0,12.47-3.24,12.47-8.59,0-6.48-6.8-7.61-16.69-10.69Z"/><path class="cls-1" d="M468.8,291.52v-34.67h-13.77v-16.69h7.29c6.64,0,9.23-2.59,9.23-9.23v-12.47h17.17v21.71h19.44v16.69h-19.44v34.67c0,7.78,4.05,12.15,11.5,12.15,2.27,0,5.02-.32,6.64-.81v16.85c-2.43,.65-6.97,1.13-10.53,1.13-18.14,0-27.54-10.04-27.54-29.32Z"/><path class="cls-1" d="M518.04,280.18c0-24.79,16.69-41.96,40.5-41.96s40.34,17.01,40.34,41.47c0,1.94-.32,5.02-.65,7.13h-59.94c1.46,10.85,10.69,18.14,22.52,18.14,8.75,0,16.36-3.24,21.38-9.07l12.15,11.83c-7.29,9.4-19.93,14.42-34.51,14.42-24.62,0-41.8-17.33-41.8-41.96Zm20.25-8.1h40.34c-1.3-10.53-9.4-17.66-20.25-17.66s-18.95,7.13-20.09,17.66Z"/><path class="cls-1" d="M615.57,240.17h18.95v13.28h.32c3.89-9.07,11.02-13.93,20.41-13.93,2.43,0,5.83,.32,7.13,.81v19.12c-2.27-.65-6.64-1.13-9.88-1.13-10.21,0-16.85,7.78-16.85,19.76v42.12h-20.09v-80.03Z"/><path class="cls-1" d="M668.06,280.51c0-24.79,16.36-42.28,39.53-42.28,10.69,0,19.44,4.7,24.95,13.28h.32v-48.76h20.09v117.45h-18.95v-12.47h-.32c-5.18,9.07-14.9,14.42-26.08,14.42-23.17,0-39.53-17.33-39.53-41.63Zm64.8-.32c0-14.42-8.91-23.98-22.03-23.98s-22.19,9.72-22.19,23.98,8.91,23.98,22.19,23.98,22.03-9.56,22.03-23.98Z"/><path class="cls-1" d="M768.33,297.35c0-15.39,12.8-24.62,34.18-24.79l15.55-.16v-2.59c0-9.4-5.99-14.26-16.85-14.26-7.13,0-13.45,2.75-17.82,7.78l-12.15-11.83c6.97-8.59,18.14-13.28,31.91-13.28,21.38,0,34.99,11.66,34.99,30.29v31.75c0,2.92,1.3,4.21,4.54,4.21h1.46v15.71h-9.4c-7.61,0-12.8-3.56-14.42-9.4h-.32c-5.02,7.29-13.28,11.34-23.33,11.34-16.85,0-28.35-10.04-28.35-24.79Zm49.73-6.97v-4.54l-13.28,.16c-10.53,.16-16.2,3.89-16.2,10.85,0,6.16,4.86,10.53,11.66,10.53,10.53,0,17.82-6.97,17.82-17.01Z"/><path class="cls-1" d="M859.86,240.17h18.79v10.85h.32c4.05-8.26,11.18-12.8,20.41-12.8,10.37,0,18.14,4.54,23,13.61,4.86-8.75,13.77-13.61,25.11-13.61,19.76,0,29.32,11.02,29.32,33.54v48.44h-20.09v-45.04c0-13.12-4.54-19.44-13.93-19.44s-14.42,6.97-14.42,20.09v44.39h-20.09v-45.04c0-13.28-4.37-19.44-13.93-19.44s-14.42,7.13-14.42,20.09v44.39h-20.09v-80.03Z"/></g><g id="Andreaskruisen"><polygon class="cls-1" points="0 320.19 30 290.19 0 260.19 20 240.19 50 270.19 80 240.19 100 260.19 70 290.19 100 320.19 80 340.19 50 310.19 20 340.19 0 320.19"/><polygon class="cls-1" points="0 200.2 30 170.2 0 140.2 20 120.2 50 150.2 80 120.2 100 140.2 70 170.2 100 200.2 80 220.2 50 190.2 20 220.2 0 200.2"/><polygon class="cls-1" points="0 80 30 50 0 20 20 0 50 30 80 0 100 20 70 50 100 80 80 100 50 70 20.01 100 0 80"/></g></svg>
  </div>
  <span class="by-norobot">Gewone taal voor iedere Amsterdammer</span>
</header>

<div class="hero">
  <h1><span class="h1-main">Snap wat er staat.</span><br><em class="h1-sub">En wat je moet doen.</em></h1>
  <p>Ontvang je een brief, mail of besluit van de gemeente Amsterdam die je niet goed begrijpt? Deel de tekst hieronder en weet direct wat er staat en wat je kunt doen.</p>
</div>

<div class="tool-wrapper">

  <div class="privacy-pill">
    üîì Je tekst wordt niet opgeslagen en verdwijnt na je sessie
  </div>

  <div class="input-tabs">
    <button class="tab-btn active" onclick="switchTab('text')">‚úèÔ∏è Tekst plakken</button>
    <button class="tab-btn" onclick="switchTab('pdf')">üìÑ PDF uploaden</button>
    <button class="tab-btn" onclick="switchTab('photo')">üì∑ Foto uploaden</button>
  </div>

  <div class="input-card">
    <div class="tab-panel active" id="tab-text">
      <div class="input-top">
        <span class="input-label">Deel hier je tekst</span>
        <span class="char-count" id="charCount">0 tekens</span>
      </div>
      <textarea id="briefText" placeholder="Plak hier de tekst van je brief, mail, contract of besluit..." oninput="updateCount()"></textarea>
    </div>
    <div class="tab-panel" id="tab-pdf">
      <label class="upload-zone" for="pdfInput">
        <input type="file" id="pdfInput" accept=".pdf" onchange="handlePdfUpload(this)">
        <div class="upload-icon">üìÑ</div>
        <div class="upload-text">Klik om een PDF te kiezen</div>
        <div class="upload-sub">of sleep hem hier naartoe</div>
      </label>
      <div class="upload-selected" id="pdfSelected"><span>üìÑ</span><span id="pdfName"></span></div>
    </div>
    <div class="tab-panel" id="tab-photo">
      <label class="upload-zone" for="photoInput">
        <input type="file" id="photoInput" accept="image/jpeg,image/png,image/webp,image/gif" capture="environment" onchange="handlePhotoUpload(this)">
        <div class="upload-icon">üì∑</div>
        <div class="upload-text">Maak een foto of kies een afbeelding</div>
        <div class="upload-sub">JPG, PNG of WebP ‚Äî zorg voor goede belichting</div>
      </label>
      <div class="upload-selected" id="photoSelected"><span>üì∑</span><span id="photoName"></span></div>
    </div>
  </div>

  <button class="submit-btn" id="submitBtn" onclick="analysesBrief()">
    Vertaal naar gewone taal <span class="btn-arrow">‚Üí</span>
  </button>

  <div class="error-box" id="errorBox"></div>

  <div class="loading" id="loading">
    <div class="loading-ring"></div>
    <div class="loading-text">We lezen je brief zorgvuldig...</div>
  </div>

  <div class="output-card" id="outputCard">
    <div class="output-header">
      <div class="output-check">‚úì</div>
      <span class="output-header-text">Uitleg van je brief</span>
      <span class="output-header-sub">in gewone taal</span>
    </div>

    <div class="output-body" id="outputBody"></div>

    <div class="output-footer">
      <span class="disclaimer">BegrijpDit geeft uitleg, geen juridisch advies. Bij twijfel, neem contact op met de betreffende instantie of een vertrouwd persoon.</span>
      <button class="reset-btn" onclick="resetTool()">‚Üê Nieuwe brief</button>
    </div>
  </div>

  <!-- SchrijfDit trigger -->
  <div class="schrijfdit-trigger" id="schrijfditTrigger" style="display:none">
    <div class="schrijfdit-trigger-inner">
      <div class="schrijfdit-icon">‚úçÔ∏è</div>
      <div class="schrijfdit-trigger-text">
        <div class="schrijfdit-brand">SchrijfDit</div>
        <div class="schrijfdit-title">Wil je reageren op deze brief?</div>
        <div class="schrijfdit-sub">Schrijft een passende reactie voor je ‚Äî in gewone, nette taal.</div>
      </div>
    </div>
    <button class="schrijfdit-btn" onclick="openSchrijfDit()">Schrijf een reactie ‚Üí</button>
  </div>

  <!-- SchrijfDit card -->
  <div class="schrijfdit-card" id="schrijfditCard" style="display:none">
    <div class="output-header">
      <div class="output-check" style="background:#e8f0fe;color:#1a56db">‚úç</div>
      <span class="output-header-text schrijfdit-brand-header">SchrijfDit</span>
      <span class="output-header-sub">Jouw reactie in gewone taal</span>
    </div>
    <div class="schrijfdit-form">
      <div class="schrijfdit-question">Wat wil je zeggen of vragen?</div>
      <div class="suggesties" id="suggestiesBtns"></div>
      <textarea id="schrijfditInput" placeholder="Of typ hier zelf wat je wil zeggen..." style="min-height:100px"></textarea>
      <button class="submit-btn" id="schrijfditBtn" onclick="genereerReactie()" style="margin-top:0.75rem">
        Schrijf mijn reactie <span class="btn-arrow">‚Üí</span>
      </button>
    </div>
    <div class="loading" id="schrijfditLoading">
      <div class="loading-ring"></div>
      <div class="loading-text">We schrijven je reactie...</div>
    </div>
    <div class="schrijfdit-output" id="schrijfditOutput" style="display:none">
      <div class="schrijfdit-result-label">Jouw reactie</div>
      <div class="schrijfdit-result" id="schrijfditResult"></div>
      <div class="schrijfdit-actions">
        <button class="copy-btn" onclick="kopieerReactie()">üìã Kopieer tekst</button>
        <button class="reset-btn" onclick="resetSchrijfDit()">‚Ü∫ Andere reactie</button>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="footer-logo"><span>BegrijpDit</span> voor Gemeente Amsterdam ‚Äî mogelijk gemaakt door <strong>NoRobot</strong></div>
  <span class="footer-note">Geen opslag ¬∑ Geen juridisch advies ¬∑ Gemaakt voor mensen</span>
</footer>

<script>
  let activeTab = 'text';
  let pdfBase64 = null;
  let photoBase64 = null;
  let photoMimeType = null;
  let lastBriefText = '';
  let lastOutputText = '';

  function switchTab(tab) {
    activeTab = tab;
    document.querySelectorAll('.tab-btn').forEach((btn, i) => {
      btn.classList.toggle('active', ['text','pdf','photo'][i] === tab);
    });
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
  }

  function handlePdfUpload(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      pdfBase64 = e.target.result.split(',')[1];
      document.getElementById('pdfName').textContent = file.name;
      document.getElementById('pdfSelected').classList.add('visible');
    };
    reader.readAsDataURL(file);
  }

  function handlePhotoUpload(input) {
    const file = input.files[0];
    if (!file) return;
    photoMimeType = file.type;
    const reader = new FileReader();
    reader.onload = (e) => {
      photoBase64 = e.target.result.split(',')[1];
      document.getElementById('photoName').textContent = file.name;
      document.getElementById('photoSelected').classList.add('visible');
    };
    reader.readAsDataURL(file);
  }

  // Drag and drop for PDF
  function initDragDrop() {
    const pdfZone = document.querySelector('#tab-pdf .upload-zone');
    const photoZone = document.querySelector('#tab-photo .upload-zone');

    [pdfZone, photoZone].forEach(zone => {
      zone.addEventListener('dragover', (e) => {
        e.preventDefault();
        zone.style.background = 'var(--accent-light)';
        zone.style.borderColor = 'var(--accent)';
      });
      zone.addEventListener('dragleave', () => {
        zone.style.background = '';
        zone.style.borderColor = '';
      });
      zone.addEventListener('drop', (e) => {
        e.preventDefault();
        zone.style.background = '';
        zone.style.borderColor = '';
        const file = e.dataTransfer.files[0];
        if (!file) return;
        if (zone === pdfZone) {
          if (!file.name.endsWith('.pdf')) {
            showError('Kies een PDF-bestand.');
            return;
          }
          const fakeInput = { files: [file] };
          handlePdfUpload(fakeInput);
        } else {
          const allowed = ['image/jpeg','image/png','image/webp','image/gif'];
          if (!allowed.includes(file.type)) {
            showError('Kies een JPG, PNG of WebP afbeelding.');
            return;
          }
          const fakeInput = { files: [file] };
          handlePhotoUpload(fakeInput);
        }
      });
    });
  }

  // Init on load
  document.addEventListener('DOMContentLoaded', initDragDrop);

  function updateCount() {
    const len = document.getElementById('briefText').value.length;
    document.getElementById('charCount').textContent = len.toLocaleString('nl') + ' tekens';
  }

  async function analysesBrief() {
    let messages = [];

    if (activeTab === 'text') {
      const text = document.getElementById('briefText').value.trim();
      if (!text || text.length < 20) {
        showError('Plak eerst de tekst van je brief of mail hierboven.');
        return;
      }
      messages = [{ role: 'user', content: 'Dit is het bericht dat ik wil begrijpen:\n\n' + text }];

    } else if (activeTab === 'pdf') {
      if (!pdfBase64) {
        showError('Kies eerst een PDF-bestand.');
        return;
      }
      messages = [{
        role: 'user',
        content: [
          { type: 'document', source: { type: 'base64', media_type: 'application/pdf', data: pdfBase64 } },
          { type: 'text', text: 'Dit is de brief die ik wil begrijpen. Leg hem uit.' }
        ]
      }];

    } else if (activeTab === 'photo') {
      if (!photoBase64) {
        showError('Kies eerst een foto van je brief.');
        return;
      }
      messages = [{
        role: 'user',
        content: [
          { type: 'image', source: { type: 'base64', media_type: photoMimeType || 'image/jpeg', data: photoBase64 } },
          { type: 'text', text: 'Dit is een foto van de brief die ik wil begrijpen. Lees de tekst en leg hem uit.' }
        ]
      }];
    }

    hideError();
    setLoading(true);
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('outputCard').classList.remove('visible');

    const systemPrompt = `Je bent BegrijpDit, een uitlegassistent van NoRobot. Je helpt mensen begrijpen wat offici√´le berichten, contracten en juridische documenten betekenen ‚Äî zoals brieven van de gemeente, belastingdienst, zorgverzekeraar, woningcorporatie, maar ook hypotheekaktes, huurcontracten, arbeidsovereenkomsten en notari√´le teksten.

JOUW TAAK:
Leg de brief uit alsof je het uitlegt aan iemand die weinig leest of weinig te maken heeft met offici√´le taal. Gebruik altijd korte zinnen. Gebruik alleen woorden die iedereen kent. Nooit juridische taal. Nooit lange zinnen. Schrijf rustig en vriendelijk.

GEBRUIK ALTIJD PRECIES DEZE STRUCTUUR:

WAT STAAT ER?
Leg in maximaal 3 korte zinnen uit waar de brief over gaat. Gebruik de simpelste woorden die je kent. Stel je voor dat je het uitlegt aan iemand die de brief voor het eerst ziet.

WAT MOET JE DOEN?
Geef maximaal 5 concrete stappen als een lijst. Begin elke stap met een werkwoord. Zeg ook wanneer iets moet gebeuren als dat in de brief staat. Wees zo concreet mogelijk: wat precies, hoe, wanneer.

WAT KAN WACHTEN?
Noem in 1 of 2 zinnen wat niet meteen hoeft. Als alles urgent is, schrijf dan: "Alles in deze brief vraagt om actie."

WAT ALS JE NIETS DOET?
Leg in maximaal 2 zinnen rustig maar eerlijk uit wat er kan gebeuren als iemand niets doet. Niet beangstigend, wel duidelijk.

Sluit altijd af met √©√©n korte zin die begint met: "Bij twijfel:"

EXTRA REGELS:
- Schrijf altijd in jij-vorm
- Maximaal 15 woorden per zin
- Geen woorden als: derhalve, conform, inzake, betreffende, zulks, ingevolge
- Als een datum of bedrag in de brief staat, benoem die altijd expliciet
- Als er iets ondertekend of teruggestuurd moet worden, zeg dat altijd als eerste actiepunt
- Als er een referentienummer, kenmerk, zaaknummer of relatienummer in de brief staat: noem dit ALTIJD in "WAT STAAT ER?", in de actiepunten, √©n in "Bij twijfel:"
- Bij twijfel: schrijf hier een CONCRETE zin met een telefoonnummer of e-mailadres UIT DE BRIEF zelf, plus het kenmerk of zaaknummer. Schrijf dus NOOIT alleen "ga naar [instantie]" of "neem contact op met [instantie]" zonder contactgegevens. Als er een telefoonnummer in de brief staat: gebruik dat. Als er een e-mailadres is: gebruik dat. En voeg altijd het kenmerk/zaaknummer toe dat in de brief staat. Voorbeeld bij belastingbrief met kenmerk: "Bij twijfel: bel de Belastingdienst en vermeld kenmerk 1012.82.345.F.01.5270."
- Gebruik NOOIT asterisks (*) of markdown opmaak in je antwoord
- Schrijf de vier kopjes EXACT zo: WAT STAAT ER? / WAT MOET JE DOEN? / WAT KAN WACHTEN? / WAT ALS JE NIETS DOET?
- Zet actiepunten ALTIJD als genummerde lijst: 1. tekst, 2. tekst, etc.`;

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 2000,
          system: systemPrompt,
          messages: messages
        })
      });

      const data = await response.json();
      if (!response.ok) throw new Error(data.error?.message || response.status);
      const text = data.content?.find(b => b.type === 'text')?.text || 'Geen antwoord ontvangen';
      lastBriefText = activeTab === 'text' ? document.getElementById('briefText').value.trim() : '[document]';
      lastOutputText = text;
      renderOutput(text);

    } catch (err) {
      showError('Er ging iets mis. Controleer je verbinding en probeer het opnieuw.');
      console.error(err);
    } finally {
      setLoading(false);
      document.getElementById('submitBtn').disabled = false;
    }
  }

  function renderOutput(rawText) {
    // Clean all markdown artifacts
    let text = rawText
      .replace(/\*\*/g, '')
      .replace(/\*/g, '')
      .replace(/##/g, '')
      .trim();

    const sections = [
      { key: 'WAT STAAT ER?', label: 'Wat staat er?', isAction: false },
      { key: 'WAT MOET JE DOEN?', label: 'Jouw actiepunten', isAction: true },
      { key: 'WAT KAN WACHTEN?', label: 'Wat kan wachten?', isAction: false },
      { key: 'WAT ALS JE NIETS DOET?', label: 'Wat als je niets doet?', isAction: false },
    ];

    let html = '';
    let firstBlock = true;

    sections.forEach((section, i) => {
      const startIdx = text.indexOf(section.key);
      if (startIdx === -1) return;

      const contentStart = startIdx + section.key.length;
      const nextKeys = sections.slice(i + 1)
        .map(s => text.indexOf(s.key, contentStart))
        .filter(x => x !== -1);
      const endIdx = nextKeys.length ? Math.min(...nextKeys) : text.length;

      let content = text.substring(contentStart, endIdx).trim();
      
      // Remove any "Bij twijfel" line from section content
      content = content.replace(/Bij twijfel[^\n]*/g, '').trim();
      
      const lines = content.split('\n').map(l => l.trim()).filter(l => l.length > 2);
      const isListItem = l => /^\d+[.)\s]/.test(l) || /^[-‚Ä¢]/.test(l);
      const cleanItem = l => l.replace(/^\d+[.)\s]+/, '').replace(/^[-‚Ä¢]\s*/, '').trim();
      
      const listItems = lines.filter(isListItem).map(cleanItem).filter(l => l.length > 2);
      const textLines = lines.filter(l => !isListItem(l)).filter(l => l.length > 2);

      if (!firstBlock) html += '<div class="output-divider"></div>';
      firstBlock = false;

      if (section.isAction) {
        const items = listItems.length ? listItems : textLines;
        html += `
          <div class="action-block">
            <div class="action-header">
              <div class="action-icon">‚Üí</div>
              <span class="action-title">Jouw actiepunten</span>
            </div>
            <ul class="action-list">
              ${items.map(item => `<li>${item}</li>`).join('')}
            </ul>
          </div>`;
      } else {
        let formatted = '';
        if (listItems.length) {
          const intro = textLines.join(' ');
          formatted = (intro ? `<p style="margin-bottom:0.5rem">${intro}</p>` : '') +
            '<ul style="list-style:none;padding:0">' +
            listItems.map(b => `<li style="padding:0.3rem 0 0.3rem 1.2rem;position:relative"><span style="position:absolute;left:0;color:var(--accent)">‚Üí</span>${b}</li>`).join('') +
            '</ul>';
        } else {
          formatted = textLines.join('<br>');
        }
        html += `
          <div class="output-block">
            <div class="block-label">${section.label}</div>
            <div class="block-text">${formatted}</div>
          </div>`;
      }
    });

    // Closing note
    const closingMatch = text.match(/Bij twijfel[^.\n]+[.]/);
    if (closingMatch) {
      html += `<div class="output-divider"></div><div class="closing-note">üí¨ ${closingMatch[0]}</div>`;
    }

    document.getElementById('outputBody').innerHTML = html;
    document.getElementById('outputCard').classList.add('visible');
    
    // Generate SchrijfDit suggestions based on output
    genereerSuggesties(text);
    document.getElementById('schrijfditTrigger').style.display = 'block';
    document.getElementById('schrijfditCard').style.display = 'none';
    document.getElementById('schrijfditOutput').style.display = 'none';
    document.getElementById('schrijfditInput').value = '';
    setTimeout(() => {
      document.getElementById('outputCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }

  function resetTool() {
    document.getElementById('briefText').value = '';
    document.getElementById('outputCard').classList.remove('visible');
    document.getElementById('schrijfditTrigger').style.display = 'none';
    document.getElementById('schrijfditCard').style.display = 'none';
    pdfBase64 = null; photoBase64 = null; photoMimeType = null;
    lastBriefText = ''; lastOutputText = '';
    document.getElementById('pdfSelected').classList.remove('visible');
    document.getElementById('photoSelected').classList.remove('visible');
    document.getElementById('pdfInput').value = '';
    document.getElementById('photoInput').value = '';
    updateCount();
    switchTab('text');
    window.scrollTo({ top: 0, behavior: 'smooth' });
    setTimeout(() => document.getElementById('briefText').focus(), 400);
  }

  function setLoading(show) {
    document.getElementById('loading').classList.toggle('visible', show);
  }

  function showError(msg) {
    const el = document.getElementById('errorBox');
    el.textContent = msg;
    el.classList.add('visible');
  }

  function hideError() {
    document.getElementById('errorBox').classList.remove('visible');
  }

  function genereerSuggesties(outputText) {
    // Smart suggestions based on content
    const suggestions = [];
    const lower = outputText.toLowerCase();
    
    if (lower.includes('betaal') || lower.includes('bedrag') || lower.includes('euro') || lower.includes('schuld')) {
      suggestions.push('Ik kan dit (nu) niet betalen');
      suggestions.push('Ik wil een betalingsregeling');
    }
    if (lower.includes('bezwaar') || lower.includes('besluit') || lower.includes('weiger') || lower.includes('afgewezen')) {
      suggestions.push('Ik ben het hier niet mee eens');
      suggestions.push('Ik wil bezwaar maken');
    }
    if (lower.includes('vergunning') || lower.includes('aanvraag') || lower.includes('melding')) {
      suggestions.push('Ik wil meer informatie');
      suggestions.push('Ik heb een vraag over mijn aanvraag');
    }
    if (lower.includes('datum') || lower.includes('deadline') || lower.includes('termijn') || lower.includes('voor')) {
      suggestions.push('Ik heb meer tijd nodig');
    }
    
    // Always add generic options
    if (suggestions.length < 2) suggestions.push('Ik wil meer informatie');
    suggestions.push('Ik heb een andere vraag');

    const container = document.getElementById('suggestiesBtns');
    container.innerHTML = suggestions.slice(0, 4).map(s => 
      `<button class="suggestie-btn" onclick="kiesSuggestie(this, '${s}')">${s}</button>`
    ).join('') + `<button class="suggestie-btn" onclick="kiesSuggestie(this, '')">Anders ‚Üí</button>`;
  }

  function kiesSuggestie(btn, tekst) {
    document.querySelectorAll('.suggestie-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const input = document.getElementById('schrijfditInput');
    if (tekst) {
      input.value = tekst;
    } else {
      input.value = '';
      input.focus();
    }
  }

  function openSchrijfDit() {
    document.getElementById('schrijfditCard').style.display = 'block';
    document.getElementById('schrijfditTrigger').style.display = 'none';
    setTimeout(() => {
      document.getElementById('schrijfditCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
      document.getElementById('schrijfditInput').focus();
    }, 100);
  }

  async function genereerReactie() {
    const intentie = document.getElementById('schrijfditInput').value.trim();
    if (!intentie || intentie.length < 5) {
      alert('Vertel eerst kort wat je wil zeggen of vragen.');
      return;
    }

    document.getElementById('schrijfditBtn').disabled = true;
    document.getElementById('schrijfditLoading').classList.add('visible');
    document.getElementById('schrijfditOutput').style.display = 'none';

    const systemPrompt = `Je bent SchrijfDit, een schrijfassistent van NoRobot. Je helpt mensen een heldere, nette reactie schrijven op een brief of besluit van een instantie.

JOUW TAAK:
Schrijf een reactiebrief in gewone, correcte taal. De brief moet:
- Vriendelijk maar duidelijk zijn
- In ik-vorm geschreven zijn (het is de brief van de gebruiker)
- Kort en to the point zijn ‚Äî maximaal 3 alinea's
- Beginnen met een aanhef zoals "Geachte mevrouw/meneer,"
- Eindigen met "Met vriendelijke groet," gevolgd door een lege regel voor de naam

VERPLICHT IN DE BRIEF:
- Als er een zaaknummer, kenmerk, referentienummer of relatienummer in de originele brief staat, vermeld dit ALTIJD in de aanhef of eerste zin: bijv. "Betreft: zaaknummer GM-2025-029021"
- Als er een afzenderadres in de brief staat, zet dat bovenaan als adressering
- Als er een datum of deadline in de brief staat, verwijs daar concreet naar

SCHRIJF ALLEEN DE BRIEF. Geen uitleg, geen toelichting eromheen.`;

    const briefContext = (lastBriefText && lastBriefText !== '[document]')
      ? `Dit was de originele brief:\n\n${lastBriefText}`
      : `Dit is de uitleg van de brief die de gebruiker heeft ge√ºpload (gebruik dit als context voor de reactiebrief):\n\n${lastOutputText}`;

    const userMessage = `${briefContext}\n\nDit is wat de gebruiker wil zeggen of vragen:\n${intentie}\n\nSchrijf een passende reactiebrief. Gebruik alle relevante details zoals zaaknummer, adres en bedragen die je uit de context kunt halen.`;

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          system: systemPrompt,
          messages: [{ role: 'user', content: userMessage }]
        })
      });

      const data = await response.json();
      if (!response.ok) throw new Error(data.error?.message || response.status);
      const resultText = data.content?.find(b => b.type === 'text')?.text || 'Geen reactie ontvangen';

      document.getElementById('schrijfditResult').textContent = resultText;
      document.getElementById('schrijfditOutput').style.display = 'block';
      setTimeout(() => {
        document.getElementById('schrijfditOutput').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);

    } catch (err) {
      alert('Er ging iets mis. Probeer het opnieuw.');
      console.error(err);
    } finally {
      document.getElementById('schrijfditBtn').disabled = false;
      document.getElementById('schrijfditLoading').classList.remove('visible');
    }
  }

  function kopieerReactie() {
    const text = document.getElementById('schrijfditResult').textContent;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = '‚úì Gekopieerd!';
      setTimeout(() => { btn.textContent = 'üìã Kopieer tekst'; }, 2000);
    });
  }

  function resetSchrijfDit() {
    document.getElementById('schrijfditInput').value = '';
    document.getElementById('schrijfditOutput').style.display = 'none';
    document.getElementById('schrijfditInput').focus();
  }
</script>

</body>
</html>
